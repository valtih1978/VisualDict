 <html>
 <head>
   <title>Google Drive Realtime quickstart</title>
   <meta http-equiv="X-UA-Compatible" content="IE=9">
   <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
   <script type="text/javascript" src="valutils.js"></script>
   <script type="text/javascript" src="realtime-client-utils.js"></script>
   
   <script>
 	
 	// called by controller.js
	function onFileLoaded(doc) {printAll()}
 	function printAll() { 
 		var keys = controller.graph.keys() ; document.querySelector("#textarea1").value = ""
 		for (i in keys) {
 			console.log(keys[i] + " => " + controller.graph.get(keys[i]))
 			document.querySelector("#textarea1").value += keys[i] + " => " + controller.graph.get(keys[i]) + "\n"
		}
	}
	
	var refreshTimer
	function onMapValueChanged(evt) {
		//console.log("event = " + showAll(evt))
		
		// null => "" when created
		// "something" => null when deleted
		if (evt.newValue == null) console.log("remote event: deleted " + evt.property)
		else if (evt.oldValue == null) console.log("remote event: created " + evt.property)
		else console.log("remote event: model updated " +  evt.property + ": " + evt.oldValue + " => " + evt.newValue)
		
		clearTimeout(refreshTimer) ; refreshTimer = setTimeout(printAll, 300);
	}
	</script>
   <script type="text/javascript" src="controller.js"></script>
 </head>
 
 <!-- Start Realtime when the body has loaded. -->
<body onLoad='startRealtime()'>
 
   <button id="authorizeButton" disabled>You must authorize</button>
   <button id="pick" onclick="pick()">Pick another file</button>
   <!-- Undo and redo buttons. -->
   <button id="undoButton" disabled>Undo</button>
   <button id="redoButton" disabled>Redo</button>
 <p>
	<button onclick="control('createNode')">New Node</button>
	<button onclick="control('deleteNode')">Delete Node</button>
	<button onclick="control('renameNode')">Rename Node</button>
	<button onclick="control('connect')">Connect</button> 
	<button onclick="control('disconnectNodes')">Disconnect</button>
	<input id="a_input" size="4"/><input id="b_input" size="4"/>
 	<button onclick="printAll()">Show all</button>
 	<p>
 	<textarea id="textarea1" disabled rows=7 align="right" style="float:left;margin:0px 10px 0px 0px;"></textarea>
	<script>
	
	function control(func) { 
		controller[func](a_input.value, b_input.value) 
	}
	
	function redirect(url) {
		window.open(url + location.hash)
	}
	</script>
	
	This is a project to replace <a href="https://translate.google.com">
	google.translate phrasebook</a>
	with decent editor, which represents related words graphically.
	Here you can edit the graph using the buttons. I have 
	<a href="javascript:redirect('almende-vis.html')">
	started visual editor</a> based on Almende example 21 (see 
	below). We need to autoexpand/collapse functionality on mouse 
	hover, the way <a href="http://arborjs.org"> arborjs.org</a> 
	and <a href="http://maxdemarzi.com/2013/05/29/visualizing-the-news-with-vivagraph-js/">
	VivaGraph (example down)</a> do.
		<p>
	Unlike most graph models, current graph model does not use 
	node/edge ids. Nodes are identified with labels. This 
	complicates renaming and might inflate DB size. Yet, <a href="http://stackoverflow.com/questions/28196581/locking-in-google-realtime-db">
	not all identifiers are shorter than natural words.</a>
		<p>
		Thanks to Google Drive Realtime API, you can 
	<a target="_blank" href="#">created word nets collaboratively.</a> 
	This might be an overkill and not very reliable (can be
	corrupted due to concurrency, see link above) but enableds 
	undo/redo for free.
	<hr>
	Here is mine analysis of graph-drawing engines.<p>
		<li>
	<a href="javascript:redirect('cytoscape.html')">Cytoscape</a> loads 
	realtime data but fails to make connections. Cytoscape seems good visualizer but unsatisfactory editor.</li><li>
	<a href="javascript:redirect('graph-creator.html')">Graph Creator</a> 
	Thoug it does support "make connections" facility, it does not support automatic layout and
	Integration with Realtime Model was not even started.</li>
	<li>
		I have later realized that I can connect nodes like this 
		https://dl.dropboxusercontent.com/u/4189520/GraphJS/graphjs.html 
		-- simply by selecting two nodes. It also worth to try web-cola
		and <a href="javascript:redirect('vivagraph.html')">VivaGraphJS</a> in place of cytoscape. They seem to provide better 
		and be more "dynamic" layout with less verbose API.
		<p> VivaGraph looks very nice and allows a lot of freedom 
			in drawing the objects. You can specify connections (links)
			without nodes (nodes are added automatically).
			However, events, eg. "hover" areachieved
			by manual drawing of the objects, which I do not like. 
			This issue is further aggraviated by stupid API, where we have 
			to write Viva.Graph.svg('circle').attr('r', 10).attr("fill", "red")
			instead of Viva.Graph.svg('circle', {r:1, color:"red"}).
			<p>VivoGraph maintains <a href="http://anvaka.github.io/graph-drawing-libraries/#/all">
			a list of graphical libraries</a>. <a href="http://anvaka.github.io/graph-drawing-libraries/#/library/dhotson_springy">
			Springy</a> example seems the thing that we are lookig for. It howerver 
			drwas arrows (which might be confusing) and seems too dynamic 
			(use too much CPU resources). But more static Cytoscape is hardly a solution
			because its layout is too dumb. 
	</li>
	<li>
	<a href="javascript:redirect('almende-vis.html')">
		almende_vis</a> and <a href="alchemy.html">Graph Alchemist</a> 
	may solve this problem. It allows to select multiple nodes is the 
	example and stabilizes (stops consuming CPU cycles) after a while. 
	Almende network has strange multiselect behaviour: you must keep longer
	rather than shift-click. Adding nodes is <a href="view-source:http://almende.github.io/chap-links-library/js/network/examples/example12_adding_nodes.html">more than terrible</a> though. It requireds creating intermediate tables. The funny thing is that mine network does not have any addNode(s)/addLink(s) methods! GrphAlchemist on the other hand might be a great library but it is impossible to start with. Docks <a hre="https://github.com/GraphAlchemist/Alchemy/issues/343#issuecomment-71804741">suck from very beginning</a> and describe some inexisting configuraion properties. At least I could not find what <a href="http://graphalchemist.github.io/Alchemy/#/docs">nodeCaption</a> applies to. When I try to pan my example, it fails with Cannot read property 'conf' of undefined and "Cannot read property 'vis' of undefined" in alchemy.min.js. Yet, they somehow do that in examples: <a href="http://almende.github.io/vis/examples/network/16_dynamic_data.html">16 manual graph editor</a> and <a href="http://almende.github.io/vis/examples/network/21_data_manipulation.html">21 visual graph editor</a> (<a href="https://github.com/almende/vis/tree/master/examples/network">sources</a>)
		</li>
	<p>
	We will load data incrementally. If user wants to clean up the screen - let him refresh.
	We will also maintain uneditable but seekable list, like phrasebook does for search.
   
 </body>
 </html>