 <html>
 <head>
   <title>Google Drive Realtime quickstart</title>
   <meta http-equiv="X-UA-Compatible" content="IE=9">
   <script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
   <script type="text/javascript" src="realtime-client-utils.js"></script>
   
   <script>
 	
 	// called by controller.js
	function onFileLoaded(doc) {printAll()}
 	function printAll() { 
 		var keys = controller.graph.keys() ; document.querySelector("#textarea1").value = ""
 		for (i in keys) {
 			console.log(keys[i] + " => " + controller.graph.get(keys[i]))
 			document.querySelector("#textarea1").value += keys[i] + " => " + controller.graph.get(keys[i]) + "\n"
		}
	}
	
	var refreshTimer
	function onMapValueChanged(evt) {
		//console.log("event = " + showAll(evt))
		
		// null => "" when created
		// "something" => null when deleted
		if (evt.newValue == null) console.log("remote event: deleted " + evt.property)
		else if (evt.oldValue == null) console.log("remote event: created " + evt.property)
		else console.log("remote event: model updated " +  evt.property + ": " + evt.oldValue + " => " + evt.newValue)
		
		clearTimeout(refreshTimer) ; refreshTimer = setTimeout(printAll, 300);
	}
	</script>
   <script type="text/javascript" src="controller.js"></script>
 </head>
 
 <!-- Start Realtime when the body has loaded. -->
<body onLoad='startRealtime()'>
 
   <button id="authorizeButton" disabled>You must authorize</button>
   <button id="pick" onclick="pick()">Pick another file</button>
   <!-- Undo and redo buttons. -->
   <button id="undoButton" disabled>Undo</button>
   <button id="redoButton" disabled>Redo</button>
 <p>
	<button onclick="control('createNode')">New Node</button>
	<button onclick="control('deleteNode')">Delete Node</button>
	<button onclick="control('renameNode')">Rename Node</button>
	<button onclick="control('connect')">Connect</button> 
	<button onclick="control('disconnectNodes')">Disconnect</button>
	<input id="a_input" size="4"/><input id="b_input" size="4"/>
 	<button onclick="printAll()">Show all</button>
 	<p>
 	<textarea id="textarea1" disabled rows=7 cols=50 align="right" style="float:left;margin:0px 10px 0px 0px;"></textarea>
	<script>
	
	function control(func) { 
		controller[func](a_input.value, b_input.value) 
	}
	
	function redirect(url) {
		window.open(url + location.hash)
	}
	</script>
	
	This is a project to replace <a href="https://translate.google.com">
	google.translate phrasebook</a>	with decent editor, which 
	allows to place related words closely next to each other.
	Here you can edit the graph using the buttons yet <a href="javascript:redirect('almende-vis.html')"> 
	visual editor was started</a>. It is based on Almende example 21, 
	see below. I think that it has reached usable stage and 
	<a href="https://www.youtube.com/watch?v=PzOmyxiEnsI">
	this video demonstrates what you should see</a>. Yet, it becomes
	difficult to work with and laggy at 700 words. To overcome
	these issues altogether, we need 
	to add dynamic autoexpand/collapse (show/hide parts of the 
	graph for the items you have selected to stay visible 
	constantly) functionality on mouse hover, the way 
	<a href="http://arborjs.org"> arborjs.org</a> 
	and <a href="http://maxdemarzi.com/2013/05/29/visualizing-the-news-with-vivagraph-js/">
	VivaGraph (example below)</a> propose, as well as language
	differentiation (node color?). Currently, related words are
	enumerated through comma in the DB (comma  is forbidden in 
	the words, therefore, though this may be wrong idea if we 
	are building a phrasebook rather than ordinary dictionary). 
	Nevertheless, so far, I think that words could
	be stored with language prefix, like en:word and et:sõna
	making
	semicolon forbidden as well. Anyway, I have started the 
	<a href="javascript:redirect('options.html')">options</a> 
	page.
	
	I have noticed that it is worth to add some clustering 
	functionality: you connect words into synrings (notions)
	Connecting synrings instead of individual words, would eliminate
	a lot of confusion.
	Might 
	be some integration with google translate is also required.
	Supporting import of google-exported prasebook is required
	for sure.
	
		<p>
	Unlike most graph models, current graph model avoids 
	node/edge ids. Nodes are identified with words/labels. This 
	complicates renaming and might inflate DB size. Yet, 
	<a href="http://stackoverflow.com/questions/28196581/locking-in-google-realtime-db">
	not all identifiers are shorter than natural words.</a>
		<p>
		Thanks to Google Drive Realtime API (<a href="http://valjok.blogspot.com/2015/01/cloud-storage.html">
		how I have picked it</a>), you can 
	<a target="_blank" href="#">produce word nets collaboratively.</a> 
	Though, this might be an overkill and is not reliable at all 
	(can be corrupted due to concurrency, see link above) but 
	unavoidable with Google RT and enableds undo/redo for free. 
	The database is stored in VisualDict file your google drive.
	You may rename it or copy it for backup and switch files 
	(trashed files are not visible for picking). Actually, 
	because <a href="http://stackoverflow.com/a/22362913/4275251">
	Google realtime documents are not garbage-collected</a> and
	there is 10 MB limit on document, we need app-generated
	backup file which would export current graph into a fresh 
	file. 
	<p>
	Alternatively,
	we could use <a href="https://coderwall.com/p/duapqq/use-a-google-spreadsheet-as-your-json-backend">
	Google Speadsheets as JSON backed</a>.
	<hr>
	Here is mine analysis of graph-drawing engines.<p>
		<li>
	<a href="javascript:redirect('cytoscape.html')">Cytoscape</a> 
	loads realtime data but fails to make connections. Cytoscape 
	seems good visualizer (now, I think it is not) and can layout
	new nodes but it is unsatisfactory editor.</li><li>
	<a href="javascript:redirect('graph-creator.html')">Graph Creator</a> 
	Thoug it does support "make connections" facility, it does not support automatic layout and
	Integration with Realtime Model was not even started.</li>
	<li>
	I have later realized that I can connect nodes like this 
	https://dl.dropboxusercontent.com/u/4189520/GraphJS/graphjs.html 
	-- simply by selecting two nodes. It also worth to try web-cola
	and <a href="javascript:redirect('vivagraph.html')">VivaGraphJS</a> in place of cytoscape. They seem to provide better 
	and be more "dynamic" layout with less verbose API.
	<p> VivaGraph looks very nice and allows a lot of freedom 
	in drawing the objects. You can specify connections (links)
	without nodes (nodes are added automatically).
	However, events, eg. "hover" areachieved
	by manual drawing of the objects, which I do not like. 
	This issue is further aggraviated by stupid API, where we have 
	to write Viva.Graph.svg('circle').attr('r', 10).attr("fill", "red")
	<a href="https://github.com/anvaka/VivaGraphJS/issues/121#issue-55491353">
	instead of Viva.Graph.svg('circle', {r:1, color:"red"})</a>.
	<p>VivoGraph maintains <a href="http://anvaka.github.io/graph-drawing-libraries/#/all">
	a list of graphical libraries</a>. <a href="http://anvaka.github.io/graph-drawing-libraries/#/library/dhotson_springy">
	Springy</a> example seems the thing that we are lookig for. It howerver 
	drwas arrows (which might be confusing) and seems too dynamic 
	(<a href="https://github.com/anvaka/VivaGraphJS/issues/121#issuecomment-71645340">
	use too much CPU resources</a>). But more static Cytoscape 
	is hardly a solution because its layout is too dumb.
	</li>
	<li>
	<a href="javascript:redirect('almende-vis.html')">
		almende_vis</a> and <a href="alchemy.html">Graph Alchemist</a> 
	address multiselect and stabilization in the examples: they
	consuming CPU cycles) after a while. Almende network has 
	strange multiselect behaviour: you must keep longer rather 
	than shift-click (I have added click+shift). Adding nodes is 
	<a href="view-source:http://almende.github.io/chap-links-library/js/network/examples/example12_adding_nodes.html">
	more than terrible</a> though. It requireds creating intermediate 
	tables. The funny thing is that mine network does not have any 
	addNode(s)/addLink(s) methods! Yet, thanks to examples
	<a href="http://almende.github.io/vis/examples/network/16_dynamic_data.html">
	(16 manual graph editor)</a> and <a href="http://almende.github.io/vis/examples/network/21_data_manipulation.html">
	(21 visual graph editor)</a>, I have realized how they achieved
	that and using it as primary editor. 
	<p>
	Now however, I think that my graph is very large and I need
	Vivagraph with its blazing WebGL performance. The stupid API
	is not the issue (<a href="https://github.com/anvaka/VivaGraphJS/issues/121#issuecomment-71645340">I could add the API myself</a>)
	The API is more complex than Almende for another reason: I see 
	no way to render text nodes (let's ignore the ugly linear 
	edges, unlike truly physical Almende's ribbons). This <a href="https://github.com/anvaka/VivaGraphJS/issues/86#issuecomment-73383520">
	seems plainly impossible. Although, <a href="http://stackoverflow.com/questions/28373796">
	asking this at Stackexchange is banned</a>. <a href="http://meta.stackoverflow.com/questions/285545">
	As usually.</a>
	<p>
	GrphAlchemist on the other hand might be a great library 
	but <a href="https://github.com/GraphAlchemist/Alchemy/issues/543">
	it is impossible to start with</a>. The docs <a hre="https://github.com/GraphAlchemist/Alchemy/issues/343#issuecomment-71804741">
	suck from the very beginning</a> and describe some inexisting 
	configuraion properties. At least I could not find what 
	<a href="http://graphalchemist.github.io/Alchemy/#/docs">
	nodeCaption</a> applies to. When I try to pan my example, 
	it fails with Cannot read property 'conf' of undefined and 
	"Cannot read property 'vis' of undefined" in alchemy.min.js. 
	</li>
	<p>
   
 </body>
 </html>